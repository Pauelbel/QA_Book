##### Умные словечки

- **Образ** - Набор слоев (например 1 слой - линукс, 2 слой - питон и т.д.)
- **runc** - инструмент для запуска контейнеров
- **containerd** - демон управляющий контейнерами (обертка над runc)

---

##### Алгоритм запуска контейнера

Клиент

1. Запуск - `docker container run`
2. Клиент конвертирует cli в API и отправляет демону через IPC

Демон

3. Слушает сокет /var/run/docker.sock
4. При получении команды демон вызывает `containerd` через gRPC
5. containerd использует `runc`

---

##### Dockerfile

Основные инструкции Dockerfile:

###### Создающие слои

| Название | Пример                                     | Описание                                                                                                          |
| ---------------- | ------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------- |
| FROM             | FROM ubuntu:latest                               | определяет базовый образ,<br />от которого будет создан новый образ. |
| RUN              | RUN apt-get update && apt-get install -y python3 | выполняет команды во время создания образа                                           |
| COPY             | COPY . /app                                      | копирует файлы или директории из хостовой системы в контейнер        |
| ADD              | ADD . /app                                       | добавляет файлы и/или архивы из хостовой системы в контейнер        |

###### Настройки

| Название | Пример                         | Описание                                                                                                                                                                              |
| ---------------- | ------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| WORKDIR          | WORKDIR /app                         | определяет рабочую директорию внутри контейнера                                                                                                    |
| CMD              | CMD ["python3", "app.py"]            | определяет команду, которая будет выполнена при запуске контейнера                                                                  |
| EXPOSE           | EXPOSE 8080                          | указывает порт, который будет прослушиваться при запуске контейнера                                                                |
| ENV              | ENV DATABASE_URL sqlite:///db.sqlite | задает значение переменной среды в контейнере                                                                                                         |
| VOLUME           | VOLUME /data                         | создает точку монтирования, которая используется для сохранения данных между<br />запусками контейнера |

---



##### Docker Compose

**Императивный** 

- Командный стиль, где инструкции задаются явно и шаг за шагом

**Декларативный**

* Можно описать желаемое состояние контейнера, не указывая конкретный порядок выполнения команд
